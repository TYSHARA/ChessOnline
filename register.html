<!DOCTYPE html>
<html>

<head>
    <title>Register</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link rel="stylesheet" type="text/css" href="css/register.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>

    <div class = "container">
    <h1>REGISTER</h1>
    <form id="register-form" method="post" action="{% url 'register' %}">
    	{% csrf_token %}
    	
        <!-- Username field -->
        <div class = "input-box">
        <input type="text" placeholder="Enter Username" required>
        <i class='bx bxs-user-rectangle'></i>
        </div>
        
        <!-- Email field (optional) -->
        <div class = "input-box">
        <input type="email" placeholder="Enter Email Address" required>
        <i class='bx bxs-envelope' ></i>
        </div>
         
        <!-- Password fields -->
        <div class = "input-box">
        <input type="password" id="password1" placeholder="Enter Password" required>
        <i class='bx bxs-lock-open-alt' ></i>
        </div>
         
        <div class = "input-box">
        <input type="password" id="password2" placeholder="Confirm Password" required>
        <i class='bx bxs-lock-alt' ></i>
        </div>
        
        <!-- Error message placeholder (for displaying registration errors) -->
        <div id="register-error" style="color: red;"></div>
    
        <!-- Submit button -->
        <button class = "reg-button" type="submit">Register</button>
    </form>
    
    <p>Already have an account? <a href="{% url 'login' %}">Login here</a></p>
    
    </div>
    <!-- JavaScript code to handle the registration form submission -->
    <img src = "./images/reg2.svg" alt="Register SVG"/>
    
    
<script>
document.getElementById('register-form').addEventListener('submit', function (event) {
    event.preventDefault();
    var username = document.getElementById('username').value;
    var email = document.getElementById('email').value;
    var password1 = document.getElementById('password1').value;
    var password2 = document.getElementById('password2').value;

    if (password1 === password2) {
       var csrfToken = document.getElementsByName('csrfmiddlewaretoken')[0].value; 


        // Create an object to hold the registration data
        var registerData = {
            username: username,
            email: email,
            password1: password1,
            password2: password2
        };

        fetch('/api/register/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify(registerData),
        })
        .then(response => {
            // Log the response text for debugging
            console.log('Response Text:', response.text());
            return response.json(); // Only call .json() once
        })
        .then(data => {
            // Handle the response data, including errors and redirects
            if (data.success) {
                // Redirect the user to the desired page after successful registration
                window.location.href = 'login.html';
            } else {
                // Display error messages in the 'register-error' div
                document.getElementById('register-error').textContent = data.error;
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    } else {
        document.getElementById('register-error').textContent = "Passwords do not match.";
    }
});

// Function to get CSRF token from the cookie
function getCookie(name) {
    var value = "; " + document.cookie;
    var parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift();
}
</script>

</body>
</html>
