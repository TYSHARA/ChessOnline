<!DOCTYPE html>
<html>
<head>
    <title>Register</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link rel="stylesheet" type="text/css" href="css/login.css">
</head>

<body>
    <div class = "container">
    <h1>REGISTER</h1>
    <form id="register-form">
    
        <!-- Username field -->
        <div class = "username">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required>
        </div>
        
        <!-- Email field (optional) -->
        <div class = "email">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email">
         </div>
         
        <!-- Password fields -->
        <div class = "enter password">
        <label for="password1">Password:</label>
        <input type="password" id="password1" name="password1" required>
        </div>
         
        <div class = "confirm password">
        <label for="password2">Confirm Password:</label>
        <input type="password" id="password2" name="password2" required>
        </div>
        
        <!-- Error message placeholder (for displaying registration errors) -->
        <div id="register-error" style="color: red;"></div>
    
        <!-- Submit button -->
        <button type="submit">Register</button>
    </form>
    
    <p>Already have an account? <a href="login.html">Login here</a></p>
    
    </div>
    <!-- JavaScript code to handle the registration form submission -->
    
    
    
<script>
document.getElementById('register-form').addEventListener('submit', function (event) {
    event.preventDefault();
    var username = document.getElementById('username').value;
    var email = document.getElementById('email').value;
    var password1 = document.getElementById('password1').value;
    var password2 = document.getElementById('password2').value;

    if (password1 === password2) {
        // Retrieve CSRF token from the cookie
        var csrftoken = getCookie('csrftoken');

        // Create an object to hold the registration data
        var registerData = {
            username: username,
            email: email,
            password1: password1,
            password2: password2
        };

        fetch('/api/register/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify(registerData),
        })
        .then(response => {
            // Log the response text for debugging
            console.log('Response Text:', response.text());
            return response.json(); // Only call .json() once
        })
        .then(data => {
            // Handle the response data, including errors and redirects
            if (data.success) {
                // Redirect the user to the desired page after successful registration
                window.location.href = '/api/login/';
            } else {
                // Display error messages in the 'register-error' div
                document.getElementById('register-error').textContent = data.error;
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    } else {
        document.getElementById('register-error').textContent = "Passwords do not match.";
    }
});

// Function to get CSRF token from the cookie
function getCookie(name) {
    var value = "; " + document.cookie;
    var parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift();
}
</script>

</body>
</html>
